<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"

      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <b:form id="formIndexLivro" >
            <b:button value="Adicionar um livro" style-class="btn btn-primary" onclick="$('#modalAddLivro').modal('show')"></b:button>
        </b:form>

        <b:modal id="modalAddLivro" title="Adicione um Livro" style-class="modalCLivro">
            <b:form id="formCadLivro" enctype="multipart/form-data">


                <b:tabView id="tabIndex" >

                    <b:tab title="Dados do Livro" id="TabDadosLivro">
                        <b:panelGrid columns="2">

                            <h:outputText value="Nome:"/>
                            <b:inputText value="#{livroController.livro.nome}"/>

                            <h:outputText value="Nome do Autor:"/>
                            <b:inputText value="#{livroController.livro.autor}"/>

                            <h:outputText value="Sinopse:"/>
                            <b:inputTextarea value="#{livroController.livro.sinopse}"/>

                            <h:outputText value="Categoria:"/>
                            <b:inputText value="#{livroController.livro.categoria}"/>
                            <p:dataTable style="width: 550px" var="tag" value="#{tagsController.readAll()}" 
                                         selection="#{livroController.livro.tags}" rowKey="#{tag.id}" 
                                         resizableColumns="true" resizeMode="expand" widgetVar="tabelaTags" >
                                <f:facet name="header">
                                    Adicione as tags do livro
                                </f:facet>
                                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                                <p:column headerText="Nome">
                                    <h:outputText value="#{peca.nome}" />
                                </p:column>
                                <p:column headerText="Função">
                                    <h:outputText value="#{peca.funcao}" />
                                </p:column>
                                <p:column headerText="Tipo">
                                    <h:outputText value="#{peca.tipo}" />
                                </p:column>
                             </p:dataTable>
                        </b:panelGrid>

                        <b:button value="próximo" look="primary" onclick="$('#formCadLivro_TabFotoLivro_tab').click()" /> 
                    </b:tab>

                    <b:tab title="Foto do Livro" id="TabFotoLivro" >
                        <b:panel id="panel1">
                            <p:fileUpload id="fotoUploader" listener="#{livroController.handleFotoLivro}"
                                          mode="advanced" dragDropSupport="false" fileLimit="1" allowTypes="/(\.|\/)(jpe?g)$/"
                                          update="panel1"/>

                            <c:if test="#{livroController.binaryPhoto!=null}">
                                <h6>Foto Adicionada</h6>
                            </c:if>
                        </b:panel>

                        <b:button value="anterior" look="secondary" onclick="$('#formCadLivro_TabDadosLivro_tab').click()"></b:button>
                        <b:commandButton value="Inserir o Livro" action="#{livroController.cadastrar()}"
                                         oncomplete="$('.modalCLivro').modal('hide')" />
                    </b:tab>

                </b:tabView>

            </b:form>
        </b:modal>

        <b:form id="formCards">
            <div style="display: flex">

                <c:forEach items="#{livroController.readAll()}"
                       var="item" varStatus="i">
                    <p:card style="width: 25rem; margin-bottom: 2em; margin-left: 2em">
                        <f:facet name="header"><h3>#{item.nome}</h3></f:facet>
                        <img src="LivroFotoDownloader?idLivro=#{item.id}"
                             style="width: 20rem"></img><br/>
                        <h:outputText value="Autor"/>
                        <h:outputText value="${item.autor}"/><br/>
                        <h:outputText value="Sinopse"/>
                        <h:outputText value="${item.sinopse}"/>
                        <!--<b:commandButton value="detalhar" 
                                         oncomplete="$('.modalDetalheContrato').modal('show')"
                                         ajax='true' update=":modalDetalheContrato">
                            <f:setPropertyActionListener value="#{item}" 
                                                         target="#{contratoController.selecionado}"/>
                        </b:commandButton>-->
                    </p:card>
                    
            </c:forEach>

        </div>
        </b:form>
        <!--<b:modal id="modalDetalheContrato" class="modalDetalheContrato fade" 
                 title="Detalhe do Contrato número #{contratoController.selecionado.codigo}">
            
            <img style="width:50%" src="ContratoFotoDownloader?idContrato=#{
                 contratoController.selecionado.codigo}" align="middle"></img><br/>
            <h4>Dados da Vítima</h4>
            <b:panelGrid columns="2">
                <h:outputText value="Nome"/>
                <h:outputText value="#{contratoController.selecionado.vitima.nome}"/>
            
                <h:outputText value="Classe Social"/>
                <h:outputText value="#{contratoController.selecionado.vitima.classeSocial}"/>
            </b:panelGrid>
            
            <h4>dados dos lances</h4>
            <b:panelGrid columns="2">
               <h:outputText value="Quantidade de Lances"/>
               <h:outputText value="#{contratoController.selecionado.lances.cotacoes.size()}"/> 
            </b:panelGrid>
            
                <b:button value="ver lances" href="lances.xhtml"
                                  look="primary"/>
            
        </b:modal>-->

    </h:body>
</html>

