<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"

      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Livro: Adm</title>
    </h:head>
    <h:body>
        <b:form id="formIndexLivro" >
            <b:button value="Adicionar um livro" style-class="btn btn-primary" onclick="$('#modalAddLivro').modal('show')"></b:button>
        </b:form>

        <b:modal id="modalAddLivro" title="Adicione um Livro" style-class="modalCLivro">
            <b:form id="formCadLivro" enctype="multipart/form-data">


                <b:tabView id="tabIndex" >

                    <b:tab title="Dados do Livro" id="TabDadosLivro">
                        <b:panelGrid columns="2">

                            <h:outputText value="Nome:"/>
                            <b:inputText value="#{livroController.livro.nome}"/>

                            <h:outputText value="Nome do Autor:"/>
                            <b:inputText value="#{livroController.livro.autor}"/>

                            <h:outputText value="Sinopse:"/>
                            <b:inputTextarea value="#{livroController.livro.sinopse}"/>
                            
                            <h:outputText value="Preço"/>
                            <p:inputNumber value="#{livroController.livro.preco}"/>

                            <h:outputText value="Categoria:"/>
                            <b:inputText value="#{livroController.livro.categoria}"/>
                            <p:dataTable style="width: 550px" var="tag" value="#{tagsController.readAll()}" 
                                         selection="#{livroController.livro.tags}" rowKey="#{tag.id}" 
                                         resizableColumns="true" resizeMode="expand" widgetVar="tabelaTags" >
                                <f:facet name="header">
                                    Adicione as tags do livro
                                </f:facet>
                                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                                <p:column headerText="Nome">
                                    <h:outputText value="#{tag.nome}" />
                                </p:column>
                             </p:dataTable>
                        </b:panelGrid>

                        <b:button value="próximo" look="primary" onclick="$('#formCadLivro_TabUploadsLivro_tab').click()" /> 
                    </b:tab>

                    <b:tab title="Uploads do Livro" id="TabUploadsLivro" >
                        <b:panel id="panel1">
                            <h:outputText value="Capa"/>
                            <p:fileUpload label="Capa" id="fotoUploader" listener="#{livroController.handleFotoLivro}"
                                          mode="advanced" dragDropSupport="false" fileLimit="1" allowTypes="/(\.|\/)(jpe?g)$/"
                                          update="panel1"/>

                            <c:if test="#{livroController.binaryPhoto!=null}">
                                <h6>Foto Adicionada</h6>
                            </c:if>
                            <h:outputText value="PDF"/>
                            <p:fileUpload label="PDF" id="pdfUploader" listener="#{livroController.handlePDFLivro}"
                                          mode="advanced" dragDropSupport="false" fileLimit="1" allowTypes="/(\.|\/)(pdf)$/"
                                          update="panel1"/>

                            <c:if test="#{livroController.binaryPDF!=null}">
                                <h6>Upload de PDF concluido</h6>
                            </c:if>
                        </b:panel>

                        <b:button value="anterior" look="secondary" onclick="$('#formCadLivro_TabDadosLivro_tab').click()"></b:button>
                        <b:commandButton value="Inserir o Livro" action="#{livroController.cadastrar()}"
                                         oncomplete="$('.modalCLivro').modal('hide')" />
                    </b:tab>

                </b:tabView>

            </b:form>
        </b:modal>

        <b:form id="formCards">
            <div style="display: flex">

                <c:forEach items="#{livroController.readAll()}"
                       var="item" varStatus="i">
                    <p:card style="width: 25rem; margin-bottom: 2em; margin-left: 2em">
                        <f:facet name="header"><h3>#{item.nome}</h3></f:facet>
                        <img src="LivroFotoDownloader?idLivro=#{item.id}"
                             style="width: 20rem"></img><br/>
                        <h:outputText value="Autor: "/>
                        <h:outputText value="${item.autor}"/><br/>
                        <h:outputText value="Sinopse: "/>
                        <h:outputText value="${item.sinopse}"/><br/>
                        <h:outputText value="Preço: "/>
                        <h:outputText value="${item.preco}"/><br/>
                        <p:commandButton value="Download" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);"
                         icon="pi pi-arrow-down" styleClass="mr-2">
                            <p:fileDownload  value="#{FileDownload.getFile(item.id)}"/>
                        </p:commandButton>
                        <!--<b:commandButton value="detalhar" 
                                         oncomplete="$('.modalDetalheContrato').modal('show')"
                                         ajax='true' update=":modalDetalheContrato">
                            <f:setPropertyActionListener value="#{item}" 
                                                         target="#{contratoController.selecionado}"/>
                        </b:commandButton>-->
                    </p:card>
                    
            </c:forEach>

        </div>
        </b:form>
    </h:body>
</html>

